<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Benutzerverwaltung - NGS System</title>
  
  <!-- CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  
  <style>
    :root {
      --primary-color: #0d6efd;
      --success-color: #28a745;
      --warning-color: #ffc107;
      --danger-color: #dc3545;
      --dark-color: #212529;
      --border-radius: 12px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    body {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      min-height: 100vh;
    }

    .main-container {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      max-width: 1200px;
    }

    .header-section {
      background: linear-gradient(135deg, var(--primary-color), #0056b3);
      color: white;
      padding: 2rem;
    }

    .table {
      border-radius: var(--border-radius);
      overflow: hidden;
      margin-bottom: 0;
    }

    .table-hover tbody tr:hover {
      background: rgba(13, 110, 253, 0.05);
      transform: scale(1.01);
      transition: var(--transition);
    }

    .table th {
      background: var(--dark-color);
      color: white;
      font-weight: 600;
      border: none;
      padding: 1rem;
    }

    .table td {
      padding: 1rem;
      vertical-align: middle;
      border-color: #e9ecef;
    }

    .btn {
      border-radius: var(--border-radius);
      font-weight: 500;
      padding: 0.5rem 1rem;
      transition: var(--transition);
      border: none;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .btn-primary {
      background: linear-gradient(45deg, var(--primary-color), #0056b3);
    }

    .btn-danger {
      background: linear-gradient(45deg, var(--danger-color), #c82333);
    }

    .btn-outline-primary {
      color: var(--primary-color);
      border: 2px solid var(--primary-color);
      background: transparent;
    }

    .btn-outline-primary:hover {
      background: var(--primary-color);
      color: white;
    }

    .badge {
      font-size: 0.75rem;
      font-weight: 600;
      padding: 0.5rem 0.75rem;
      border-radius: 50px;
    }

    .badge-admin {
      background: linear-gradient(45deg, #dc3545, #c82333);
    }

    .badge-user {
      background: linear-gradient(45deg, #6c757d, #495057);
    }

    .alert {
      border: none;
      border-radius: var(--border-radius);
      margin-bottom: 1rem;
    }

    .flash {
      border-radius: var(--border-radius);
      padding: 1rem;
      margin-bottom: 1rem;
    }

    .flash.success {
      background: linear-gradient(45deg, rgba(40, 167, 69, 0.1), rgba(40, 167, 69, 0.05));
      border-left: 4px solid var(--success-color);
      color: var(--success-color);
    }

    .flash.error {
      background: linear-gradient(45deg, rgba(220, 53, 69, 0.1), rgba(220, 53, 69, 0.05));
      border-left: 4px solid var(--danger-color);
      color: var(--danger-color);
    }

    .flash.warning {
      background: linear-gradient(45deg, rgba(255, 193, 7, 0.1), rgba(255, 193, 7, 0.05));
      border-left: 4px solid var(--warning-color);
      color: #856404;
    }

    .flash.info {
      background: linear-gradient(45deg, rgba(13, 110, 253, 0.1), rgba(13, 110, 253, 0.05));
      border-left: 4px solid var(--primary-color);
      color: var(--primary-color);
    }

    .user-info {
      background: rgba(255, 255, 255, 0.1);
      border-radius: var(--border-radius);
      padding: 0.5rem 1rem;
      display: inline-block;
    }

    .navigation-section {
      background: rgba(0, 0, 0, 0.02);
      padding: 1rem 2rem;
      border-top: 1px solid #e9ecef;
    }

    /* Role specific styling */
    .role-admin {
      color: var(--danger-color);
      font-weight: bold;
    }

    .role-user {
      color: var(--dark-color);
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .header-section {
        padding: 1rem;
        text-align: center;
      }
      
      .table-responsive {
        font-size: 0.875rem;
      }
      
      .btn {
        padding: 0.375rem 0.75rem;
        font-size: 0.875rem;
      }
    }

    /* Animation for delete confirmation */
    .delete-form {
      display: inline-block;
    }

    /* Loading state */
    .loading {
      opacity: 0.6;
      pointer-events: none;
    }

    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 3rem 2rem;
      color: #6c757d;
    }

    .empty-state i {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }
  </style>
</head>

<body>
<div class="container my-4">
  <div class="main-container mx-auto">
    
    <!-- Header -->
    <div class="header-section">
      <div class="d-flex justify-content-between align-items-center flex-wrap">
        <div>
          <h1 class="mb-2">
            <i class="fas fa-users-cog me-3"></i>
            Benutzerverwaltung
          </h1>
          <p class="mb-0 opacity-75">Systembenutzer verwalten und überwachen</p>
        </div>
        <div class="user-info">
          <i class="fas fa-user-shield me-2"></i>
          Administrator
        </div>
      </div>
    </div>

    <!-- Content -->
    <div class="p-4">
      
      <!-- Flash Messages -->
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="flash-messages">
            {% for category, message in messages %}
              <div class="flash {{ category }}">
                <i class="fas fa-info-circle me-2"></i>{{ message }}
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <!-- Users Table -->
      <div class="card border-0">
        <div class="card-header bg-light border-0 py-3">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
              <i class="fas fa-list me-2"></i>Registrierte Benutzer
            </h5>
            <span class="badge bg-primary">{{ users|length }} Benutzer</span>
          </div>
        </div>
        
        {% if users %}
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead>
              <tr>
                <th style="width: 80px;">
                  <i class="fas fa-hashtag me-1"></i>ID
                </th>
                <th>
                  <i class="fas fa-user me-1"></i>Benutzername
                </th>
                <th>
                  <i class="fas fa-envelope me-1"></i>E-Mail
                </th>
                <th style="width: 120px;">
                  <i class="fas fa-shield-alt me-1"></i>Rolle
                </th>
                <th style="width: 150px;" class="text-center">
                  <i class="fas fa-cogs me-1"></i>Aktionen
                </th>
              </tr>
            </thead>
            <tbody>
              {% for user in users %}
              <tr>
                <td>
                  <strong>#{{ user.id }}</strong>
                </td>
                <td>
                  <div class="d-flex align-items-center">
                    <i class="fas fa-user-circle text-muted me-2"></i>
                    <span class="fw-medium">{{ user.username }}</span>
                    {% if user.id == current_user.id %}
                      <span class="badge bg-info ms-2">Sie</span>
                    {% endif %}
                  </div>
                </td>
                <td>
                  {% if user.email %}
                    <i class="fas fa-envelope text-muted me-2"></i>{{ user.email }}
                  {% else %}
                    <span class="text-muted">
                      <i class="fas fa-minus me-2"></i>Nicht angegeben
                    </span>
                  {% endif %}
                </td>
                <td>
                  {% if user.role %}
                    {% if user.role.name == 'admin' %}
                      <span class="badge badge-admin">
                        <i class="fas fa-crown me-1"></i>{{ user.role.name|title }}
                      </span>
                    {% else %}
                      <span class="badge badge-user">
                        <i class="fas fa-user me-1"></i>{{ user.role.name|title }}
                      </span>
                    {% endif %}
                  {% else %}
                    <span class="text-muted">
                      <i class="fas fa-question-circle me-1"></i>Keine Rolle
                    </span>
                  {% endif %}
                </td>
                <td class="text-center">
                  {% if user.id != current_user.id %}
                    <form method="POST" action="{{ url_for('admin.delete_user', user_id=user.id) }}" class="delete-form">
                      <button type="submit" class="btn btn-danger btn-sm" 
                              onclick="return confirm('Benutzer {{ user.username }} wirklich löschen? Diese Aktion kann nicht rückgängig gemacht werden.')"
                              title="Benutzer löschen">
                        <i class="fas fa-trash me-1"></i>Löschen
                      </button>
                    </form>
                  {% else %}
                    <span class="badge bg-secondary">
                      <i class="fas fa-lock me-1"></i>Geschützt
                    </span>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <div class="empty-state">
          <i class="fas fa-users"></i>
          <h5>Keine Benutzer gefunden</h5>
          <p class="text-muted">Es sind noch keine Benutzer im System registriert.</p>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Navigation -->
    <div class="navigation-section">
      <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
        <a href="{{ url_for('analysis.analysis') }}" class="btn btn-outline-primary">
          <i class="fas fa-arrow-left me-2"></i>Zurück zur Analyse
        </a>
        <div class="text-muted small">
          <i class="fas fa-clock me-1"></i>
          Letzte Aktualisierung: {{ moment().format('DD.MM.YYYY HH:mm') if moment else 'Unbekannt' }}
        </div>
      </div>
    </div>

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Enhanced user management functionality
document.addEventListener('DOMContentLoaded', function() {
  // Add loading state to delete buttons
  document.querySelectorAll('.delete-form').forEach(form => {
    form.addEventListener('submit', function(e) {
      const button = this.querySelector('button');
      button.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Lösche...';
      button.disabled = true;
    });
  });

  // Auto-hide flash messages after 5 seconds
  document.querySelectorAll('.flash').forEach(flash => {
    setTimeout(() => {
      flash.style.transition = 'opacity 0.5s ease-out';
      flash.style.opacity = '0';
      setTimeout(() => flash.remove(), 500);
    }, 5000);
  });

  // Add confirmation animations
  document.querySelectorAll('.btn-danger').forEach(btn => {
    btn.addEventListener('mouseenter', function() {
      this.innerHTML = this.innerHTML.replace('Löschen', 'Wirklich löschen?');
    });
    btn.addEventListener('mouseleave', function() {
      this.innerHTML = this.innerHTML.replace('Wirklich löschen?', 'Löschen');
    });
  });
});
</script>

</body>
</html>